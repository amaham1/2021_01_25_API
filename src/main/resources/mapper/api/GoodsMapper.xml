<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="GoodsMapper">
	<!-- postGoods -->
	<insert id="postGoods" parameterType="hashMap">
		INSERT INTO goods_list
		(
			goods_name
			, goods_price
			, goods_desc
			, deliver_possible_dt
			, create_dt
			, goods_uploader
		)
		VALUES
		(
			#{goods_name}
			, #{goods_price}
			, #{goods_desc}
			, #{deliver_possible_dt}
			, NOW()
			, #{goods_uploader}
		)
	</insert>
	<!-- postGoods -->
	
	<!-- SQLgetGoodsList -->
	<sql id="SQLgetGoodsList">
		SELECT
			fl.farm_name
			, gl.goods_name
			, gl.goods_price
			, gl.goods_desc
			, gl.goods_id
			, DATE_FORMAT(gl.deliver_possible_dt, '%Y-%m-%d') AS deliver_possible_dt
			, DATE_FORMAT(gl.create_dt, '%Y-%m-%d %H:%i') AS create_dt
			, gl.goods_uploader
			, fl.farm_phone_num
			, fl.farm_location
			, fl.farm_photo
		FROM 
			goods_list AS gl
		LEFT JOIN farm_list AS fl
			ON fl.farm_name = gl.goods_uploader
		WHERE
			delete_dt IS NULL
			<if test="farm_name != null and farm_name !=''">
			AND fl.farm_name LIKE CONCAT('%', #{farm_name}, '%')
			</if>
			<if test="goods_name != null and goods_name !=''">
			AND gl.goods_name LIKE CONCAT('%', #{goods_name}, '%')
			</if>
			<if test="start_goods_price != null and start_goods_price !=''">
			AND gl.goods_price >= #{start_goods_price}
			</if>
			<if test="end_goods_price != null and end_goods_price !=''">
			<![CDATA[
			AND gl.goods_price <= #{end_goods_price}
			]]>
			</if>
			<if test="deliver_possible_dt != null and deliver_possible_dt !=''">
			AND gl.deliver_possible_dt >= #{deliver_possible_dt}
			</if>
			<if test="start_create_dt != null and start_create_dt !=''">
			AND gl.create_dt >= #{start_create_dt}
			</if>
			<if test="end_create_dt != null and end_create_dt !=''">
			<![CDATA[
			AND gl.create_dt <= DATE_ADD(#{end_create_dt}, INTERVAL 1 DAY)
			]]>
			</if>
	</sql>
	
	<!-- getGoodsList -->
	<select id="getGoodsList" parameterType="hashMap" resultType="com.prac.model.GoodsModel">
		<include refid="SQLgetGoodsList"/>
		ORDER BY gl.create_dt DESC
		LIMIT #{limit}, #{count}
	</select>
	<select id="getGoodsListCnt" parameterType="hashMap" resultType="Integer">
		SELECT
			COUNT(dddw.goods_name)
		FROM (<include refid="SQLgetGoodsList"/>) AS dddw
	</select>
	<!-- getGoodsList -->
	
	<!-- getGoodsDetail -->
	<select id="getGoodsDeatil" parameterType="hashMap" resultType="com.prac.model.GoodsModel">
		<include refid="SQLgetGoodsList"/>
		AND goods_id = #{goods_id}
	</select>
	<!-- getGoodsDetail -->
</mapper>